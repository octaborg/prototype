import {Field, isReady, Poseidon, shutdown} from 'snarkyjs';
import {AccountStatement} from "./octa";

describe('index.ts', () => {
    describe('foo()', () => {
        beforeAll(async () => {
            await isReady;
        });
        afterAll(async () => {
            await shutdown();
        });
        it('should be correct', async () => {
            expect(Field(1).add(1)).toEqual(Field(2));
        });
    });

    it.only('should be isomorphic for dummy account as well', async () => {
        let data = [
            "1",
            "12621",
            "1648472362",
            "1640696361",
            "1648472363",
            "1",
            "1164",
            "0",
            "1",
            "1",
            "0",
            "1640696362",
            "2",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1640696362",
            "3",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1640782762",
            "4",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1640869162",
            "5",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1640955562",
            "6",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641041962",
            "7",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641128362",
            "8",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641214762",
            "9",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641301162",
            "10",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641387562",
            "11",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641473962",
            "12",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641560362",
            "13",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641646762",
            "14",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641733162",
            "15",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641819562",
            "16",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641905962",
            "17",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1641992362",
            "18",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642078762",
            "19",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642165162",
            "20",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642251562",
            "21",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642337962",
            "22",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642424362",
            "23",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642510762",
            "24",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642597162",
            "25",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642683562",
            "26",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642769962",
            "27",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642856362",
            "28",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1642942762",
            "29",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643029162",
            "30",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643115562",
            "31",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643201962",
            "32",
            "1164",
            "0",
            "1",
            "1",
            "0",
            "1643288362",
            "33",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643288362",
            "34",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643374762",
            "35",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643461162",
            "36",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643547562",
            "37",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643633962",
            "38",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643720362",
            "39",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643806762",
            "40",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643893162",
            "41",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1643979562",
            "42",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644065962",
            "43",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644152362",
            "44",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644238762",
            "45",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644325162",
            "46",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644411562",
            "47",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644497962",
            "48",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644584362",
            "49",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644670762",
            "50",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644757162",
            "51",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644843562",
            "52",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1644929962",
            "53",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645016362",
            "54",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645102762",
            "55",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645189162",
            "56",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645275562",
            "57",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645361962",
            "58",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645448362",
            "59",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645534762",
            "60",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645621162",
            "61",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645707562",
            "62",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645793962",
            "63",
            "1164",
            "0",
            "1",
            "1",
            "0",
            "1645880362",
            "64",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645880362",
            "65",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1645966762",
            "66",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646053162",
            "67",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646139562",
            "68",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646225962",
            "69",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646312362",
            "70",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646398762",
            "71",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646485162",
            "72",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646571562",
            "73",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646657962",
            "74",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646744362",
            "75",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646830762",
            "76",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1646917162",
            "77",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647003562",
            "78",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647089962",
            "79",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647176362",
            "80",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647262762",
            "81",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647349162",
            "82",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647435562",
            "83",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647521962",
            "84",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647608362",
            "85",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647694762",
            "86",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647781162",
            "87",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647867562",
            "88",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1647953962",
            "89",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1648040362",
            "90",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1648126762",
            "91",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1648213162",
            "92",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1648299562",
            "93",
            "76",
            "1",
            "0",
            "0",
            "0",
            "1648385962"
        ];
        let payload: Field[] = [];
        for (let j = 0; j < data.length; j++) {
            const val: Field = new Field(data[j]);
            payload.push(val);
        }

        const serialized: Field[] = payload;
        // console.log(payload);

        const deserAcc = AccountStatement.deserialize(serialized);
        console.log(deserAcc.balance.value.toString());
        expect(deserAcc.transactions.length).toEqual(30);

        const deserialized: Field[] = deserAcc.serialize();
        const hash1 = Poseidon.hash(serialized);
        const hash2 = Poseidon.hash(deserialized);
        //expect(hash1).toEqual(hash2);
    });
});
